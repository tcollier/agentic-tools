# Guide for AI Agents

This document provides instructions for AI agents (like Claude Code) working in this repository.

## Issue Tracking with Beads

This repository uses **[Beads](https://github.com/beadified/beads)** for issue tracking instead of traditional tools like GitHub Issues or Jira.

### What is Beads?

Beads is a local-first, git-based issue tracker that stores issues as JSONL files alongside your code. Issues are tracked in the `.beads/` directory and automatically sync with version control.

### Key Commands

```bash
# List all issues
bd list

# List issues by status
bd list --status open
bd list --status in_progress
bd list --status blocked
bd list --status closed

# Show detailed information about an issue
bd show <issue-id>

# Create a new issue
bd create "Issue title" --type <bug|feature|task|epic|chore> --priority <0-4>

# Update issue status
bd update <issue-id> --status <open|in_progress|blocked|closed>

# Update other fields
bd update <issue-id> --assignee "name@example.com"
bd update <issue-id> --priority 1
```

### JSON Output

Most commands support `--json` flag for programmatic access:

```bash
bd list --status open --json
bd show <issue-id> --json
```

## **CRITICAL RULE: Atomic Commits**

When an AI agent fixes an issue tracked in Beads:

### ✅ Required Workflow

1. Make the code changes to fix the issue
2. Mark the corresponding bead as completed: `bd update <issue-id> --status closed`
3. **Include both code changes AND `.beads/` changes in the same commit**

Example:
```bash
# Fix the bug in code
# ... make your changes ...

# Mark the issue as closed
bd update agentic-tools-abc --status closed

# Commit everything together
git add src/my-file.js .beads/
git commit -m "Fix authentication timeout issue

Implemented exponential backoff for authentication retry logic.

Closes: agentic-tools-abc"
```

### ❌ Anti-Pattern (DO NOT DO THIS)

**Never split code changes and issue updates into separate commits:**

```bash
# BAD: Don't do this
git add src/my-file.js
git commit -m "Fix auth issue"

# Then separately
bd update agentic-tools-abc --status closed
git add .beads/
git commit -m "Mark issue as closed"
```

### Why This Matters

Keeping code changes and issue closure in the same commit ensures:

1. **Traceability**: The commit that fixes the issue clearly shows which issue was resolved
2. **Atomicity**: Changes and their tracking metadata stay synchronized
3. **Reversibility**: Reverting a commit also reverts the issue status change
4. **Clarity**: Code review shows both what changed and what issue was addressed
5. **History**: Git history accurately reflects when issues were actually resolved

## Issue Workflow for AI Agents

### When Starting Work on an Issue

1. **Check current status:**
   ```bash
   bd show <issue-id> --json
   ```

2. **Mark as in progress:**
   ```bash
   bd update <issue-id> --status in_progress
   ```

3. **Commit the status change:**
   ```bash
   git add .beads/
   git commit -m "Start work on <issue-id>: <issue-title>"
   ```

### When Completing an Issue

1. **Make all necessary code changes**
2. **Mark issue as closed:**
   ```bash
   bd update <issue-id> --status closed
   ```

3. **Commit code changes AND issue closure together:**
   ```bash
   git add <changed-files> .beads/
   git commit -m "Implement <feature-name>

   <Description of changes>

   Closes: <issue-id>"
   ```

### When Blocked

If you encounter a blocker:

```bash
bd update <issue-id> --status blocked
git add .beads/
git commit -m "Block <issue-id>: waiting for <reason>"
```

## Viewing the Issue Summary

A human-readable summary of all issues is maintained in `BEADS.md`:

- This file is auto-generated by `ext/beads/generate-beads-summary.sh`
- It's updated automatically via git pre-commit hook
- **Do not edit BEADS.md manually** - it will be overwritten

To manually regenerate:
```bash
./ext/beads/generate-beads-summary.sh
```

## Finding Issues to Work On

### List Open Issues
```bash
bd list --status open
```

### Find High-Priority Issues
```bash
bd list --status open --json | jq '.[] | select(.priority <= 1)'
```

### Search by Type
```bash
# Find bugs
bd list --json | jq '.[] | select(.issue_type == "bug" and .status == "open")'

# Find features
bd list --json | jq '.[] | select(.issue_type == "feature" and .status == "open")'
```

## Issue Types

- **bug**: Something is broken and needs fixing
- **feature**: New functionality to be added
- **task**: General work item or improvement
- **epic**: Large body of work that may spawn multiple issues
- **chore**: Maintenance work (dependencies, tooling, cleanup)

## Priority Levels

- **P0** (0): Critical, blocks major functionality
- **P1** (1): High priority, important for current milestone
- **P2** (2): Medium priority, should be addressed soon
- **P3** (3): Low priority, nice to have
- **P4** (4): Very low priority, backlog item

## Best Practices for AI Agents

1. **Always check for related issues** before creating new ones
2. **Include issue IDs in commit messages** using "Closes: issue-id" or "Relates to: issue-id"
3. **Update issue status atomically** with code changes
4. **Add acceptance criteria** when creating issues to clarify success conditions
5. **Use appropriate issue types** to help with prioritization and categorization
6. **Set realistic priorities** - not everything is P0
7. **Add context in descriptions** - future agents (and humans) will thank you

## Example: Complete Workflow

Here's a full example of an AI agent working on an issue:

```bash
# 1. Find an issue to work on
bd list --status open --json | jq '.[] | select(.priority <= 1) | {id, title, priority}'

# Output: agentic-tools-xyz - "Add rate limiting to API endpoints" (P1)

# 2. Mark it as in progress
bd update agentic-tools-xyz --status in_progress
git add .beads/
git commit -m "Start work on agentic-tools-xyz: Add rate limiting to API endpoints"

# 3. Make code changes
# ... implement rate limiting ...

# 4. Mark as closed and commit everything together
bd update agentic-tools-xyz --status closed
git add src/api/middleware/rate-limiter.js src/api/middleware/index.js .beads/
git commit -m "Add rate limiting middleware to API endpoints

Implement token bucket algorithm for rate limiting:
- 100 requests per minute per IP
- Configurable limits via environment variables
- Returns 429 status when limit exceeded
- Adds X-RateLimit headers to responses

Closes: agentic-tools-xyz"
```

## Troubleshooting

### Issue Not Updating

If `bd update` doesn't seem to work:
```bash
# Check if daemon is running
bd sync --flush-only

# Verify the change
bd show <issue-id> --json | jq '.status'
```

### .beads/ Directory Issues

If `.beads/` changes aren't appearing:
```bash
# Check git status
git status

# The .beads/ directory should show as modified
# If not, ensure beads daemon synced:
bd sync --flush-only
```

### Finding Issue IDs

Issue IDs follow the pattern: `{repo-prefix}-{short-hash}`

Example: `agentic-tools-abc`, `agentic-tools-xyz`

List all IDs:
```bash
bd list --json | jq -r '.[].id'
```

## Resources

- **Beads Documentation**: [GitHub](https://github.com/beadified/beads)
- **BEADS.md**: Auto-generated summary of all issues in this repo
- **ext/beads/README.md**: Additional beads setup documentation for this repo

---

**Remember**: The golden rule is **atomic commits** - always commit code changes and issue status updates together!
